import{r as t,c6 as Q}from"./index-CelXfcd8.js";import{s as U,i as N,a as Z,b as _,T as ee,C as te,m as re}from"./glide-data-editor-CHNuHidQ.js";import"./trash-C6Ko-g5q.js";const ie=U("div")({name:"DataGridOverlayEditorStyle",class:"gdg-d19meir1",propsAsIs:!1,vars:{"d19meir1-0":[r=>r.targetY,"px"],"d19meir1-1":[r=>r.targetX,"px"],"d19meir1-2":[r=>r.targetWidth,"px"],"d19meir1-3":[r=>r.targetHeight,"px"],"d19meir1-4":[r=>r.targetY+10,"px"],"d19meir1-5":[r=>Math.max(0,(r.targetHeight-28)/2),"px"]}});function ne(){const[r,s]=(function(){const[a,o]=t.useState();return[a??void 0,o]})(),[n,p]=t.useState(0),[v,k]=t.useState(!0);return t.useLayoutEffect(()=>{if(r===void 0||!("IntersectionObserver"in window))return;const a=new IntersectionObserver(o=>{o.length!==0&&k(o[0].isIntersecting)},{threshold:1});return a.observe(r),()=>a.disconnect()},[r]),t.useEffect(()=>{if(v||r===void 0)return;let a;const o=()=>{const{right:O}=r.getBoundingClientRect();p(x=>Math.min(x+window.innerWidth-O-10,0)),a=requestAnimationFrame(o)};return a=requestAnimationFrame(o),()=>{a!==void 0&&cancelAnimationFrame(a)}},[r,v]),{ref:s,style:t.useMemo(()=>({transform:`translateX(${n}px)`}),[n])}}const ae=r=>{const{target:s,content:n,onFinishEditing:p,forceEditMode:v,initialValue:k,imageEditorOverride:a,markdownDivCreateNode:o,highlight:O,className:x,theme:S,id:W,cell:f,bloom:u,validateCell:d,getCellRenderer:R,provideEditor:h,isOutsideClick:X,customEventTarget:Y}=r,[l,q]=t.useState(v?n:void 0),w=t.useRef(l??n);w.current=l??n;const[y,P]=t.useState(()=>d===void 0||!(N(n)&&(d==null?void 0:d(f,n,w.current))===!1)),g=t.useCallback((e,i)=>{p(y?e:void 0,i)},[y,p]),B=t.useCallback(e=>{if(d!==void 0&&e!==void 0&&N(e)){const i=d(f,e,w.current);i===!1?P(!1):(typeof i=="object"&&(e=i),P(!0))}q(e)},[f,d]),E=t.useRef(!1),m=t.useRef(void 0),G=t.useCallback(()=>{g(l,[0,0]),E.current=!0},[l,g]),j=t.useCallback((e,i)=>{g(e,i??m.current??[0,0]),E.current=!0},[g]),L=t.useCallback(async e=>{let i=!1;e.key==="Escape"?(e.stopPropagation(),e.preventDefault(),m.current=[0,0]):e.key!=="Enter"||e.shiftKey?e.key==="Tab"&&(e.stopPropagation(),e.preventDefault(),m.current=[e.shiftKey?-1:1,0],i=!0):(e.stopPropagation(),e.preventDefault(),m.current=[0,1],i=!0),window.setTimeout(()=>{E.current||m.current===void 0||(g(i?l:void 0,m.current),E.current=!0)},0)},[g,l]),D=l??n,[c,$]=t.useMemo(()=>{var C,V;if(Z(n))return[];const e={...n,location:f},i=h==null?void 0:h(e);return i!==void 0?[i,!1]:[(V=(C=R(n))==null?void 0:C.provideEditor)==null?void 0:V.call(C,e),!1]},[f,n,R,h]),{ref:z,style:J}=ne();let F,b,I=!0,T=!0;if(c!==void 0){I=c.disablePadding!==!0,T=c.disableStyling!==!0;const e=_(c);e&&(b=c.styleOverride);const i=e?c.editor:c;F=t.createElement(i,{isHighlighted:O,onChange:B,value:D,initialValue:k,onFinishedEditing:j,validatedSelection:N(D)?D.selectionRange:void 0,forceEditMode:v,target:s,imageEditorOverride:a,markdownDivCreateNode:o,isValid:y,theme:S})}b={...b,...J};const A=document.getElementById("portal");if(A===null)return console.error('Cannot open Data Grid overlay editor, because portal not found.  Please add `<div id="portal" />` as the last child of your `<body>`.'),null;let M=T?"gdg-style":"gdg-unstyle";y||(M+=" gdg-invalid"),I&&(M+=" gdg-pad");const H=(u==null?void 0:u[0])??1,K=(u==null?void 0:u[1])??1;return Q.createPortal(t.createElement(ee.Provider,{value:S},t.createElement(te,{style:re(S),className:x,onClickOutside:G,isOutsideClick:X,customEventTarget:Y},t.createElement(ie,{ref:z,id:W,className:M,style:b,as:$===!0?"label":void 0,targetX:s.x-H,targetY:s.y-K,targetWidth:s.width+2*H,targetHeight:s.height+2*K},t.createElement("div",{className:"gdg-clip-region",onKeyDown:L},F)))),A)};export{ae as default};
